package api;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;
import params.PostUsers;

import static org.springframework.web.bind.annotation.RequestMethod.DELETE;
import static org.springframework.web.bind.annotation.RequestMethod.GET;

@Controller    // This means that this class is a Controller
public class APIController {
    @Autowired // This means to get the bean called userRepository
    // Which is auto-generated by Spring, we will use it to handle the data
    private GoogleUserRepository userRepository;

    @GetMapping(path="/add") // Map ONLY GET Requests
    public @ResponseBody String addNewUser (@RequestParam String googleId
            , @RequestParam String name
            , @RequestParam String gender
            , @RequestParam String pictureUrl) {
        // @ResponseBody means the returned String is the response, not a view name
        // @RequestParam means it is a parameter from the GET or POST request

        GoogleUser n = new GoogleUser();
        n.setGoogleId(googleId);
        n.setName(name);
        n.setGender(gender);
        n.setPictureUrl(pictureUrl);

        userRepository.save(n);
        return "Saved";
    }

    @GetMapping(path="/all")
    public @ResponseBody Iterable<GoogleUser> getAllUsers() {
        // This returns a JSON or XML with the users
        return userRepository.findAll();
    }

    /**
     * Endpoint for storing user's data and activities into DB.
     * @param postUsers instance of PostUsers, deserialized from JSON.
     */
    @PostMapping(path="/users")
    public @ResponseBody String storeUserDataActivity (@RequestBody PostUsers postUsers) {

        return  String.format("storeUserDataActivity of user gid: %s, token: %s",
                postUsers.getGoogleUserId(),
                postUsers.getAccessToken());
    }


    /**
     * Endpoint which deletes the user data and his activities.
     * @param userGoogleId id of the user.
     */
    @RequestMapping(value = "/users/{userGoogleId}", method = DELETE)
    public @ResponseBody String deleteUserDataActivity(@PathVariable String userGoogleId){
        return  String.format("Deleted user and activities gid: %s", userGoogleId);
    }

    /**
     * Endpoint which returns the user data.
     * TODO: (Google ID, name, gender, profile picture URL)
     * @param userGoogleId id of the user.
     */
    @RequestMapping(value = "/users/{userGoogleId}", method = GET)
    public @ResponseBody String getUserData(@PathVariable String userGoogleId){
        return  String.format("GET user data for user userGoogleId: %s", userGoogleId);
    }


    /**
     * Endpoint which returns list of activities of the user.
     * TODO: (each with: URL on Google+, title, kind, numbers of replies, number of plusoners)
     * @param userGoogleId id of the user.
     */
    @RequestMapping(value = "/users/{userGoogleId}/activities", method = GET)
    public @ResponseBody String getUserActivities(@PathVariable String userGoogleId){
        return  String.format("GET user activities for user userGoogleId: %s", userGoogleId);
    }
}